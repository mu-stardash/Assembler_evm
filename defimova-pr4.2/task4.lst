GAS LISTING task4.S 			page 1


   1              	/**
   2              	 * –ü—Ä–æ–≥—Ä–∞–º–º–∞, —Å—É–º–º–∏—Ä—É—é—â–∞—è –æ–¥–Ω–æ—Ü–∏—Ñ—Ä–æ–≤—ã–µ —á–∏—Å–ª–∞ (–∫–∞–∫ –ø–æ–ª–æ–
   3              	 *
   4              	 * Copyright (c) 2020, Dasha Efimova <dashulya0301178@gmail.com>
   5              	*/
   6              	
   7              	.include "my-macro"
   1              	/* 
   2              	 * –ú–∞–∫—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.
   3              	 * –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
   4              	 * 	- –∫–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã
   5              	 *
   6              	 * –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä—ã: %e
   7              	 * –°–º. —Ç–∞–∫–∂–µ 'man 2 exit'
   8              	*/
   9              	.macro Exit ret_val
  10              		movl $1, %eax 		    # –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ exit –Ω–æ–º–µ—Ä 1
  11              		movl \ret_val, %ebx 	# –∫–æ–¥ –≤—ã—Ö–æ–¥–∞
  12              		int $0x80 		        # –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  13              	.endm  
  14              	
  15              	
  16              	/*
  17              	 * –ú–∞—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Ü–µ–¥—É—Ä—ã —Å—á–∏—Ç—ã–≤–∞–Ω–∏—è –æ–¥–Ω–æ–≥–æ —Å–∏–
  18              	 * –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
  19              	 * 	- –∞–¥—Ä–µ—Å –±—É—Ñ—Ñ–µ—Ä–∞ –¥–ª—è —Å—á–∏—Ç—ã–≤–∞–Ω–∏—è —Å–∏–º–≤–æ–ª–∞
  20              	 * –†–µ–∑—É–ª—å—Ç–∞—Ç:
  21              	 *	- –≤ %eax –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
  22              	 *	- –ø–æ –∞–¥—Ä–µ—Å—É buf_addr - —Å—á–∏—Ç–∞–Ω–Ω—ã–π —Å–∏–º–≤–æ–ª
  23              	 * 
  24              	 * –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä—ã: %e
  25              	 * –°–º. —Ç–∞–∫–∂–µ 'man 2 read'
  26              	*/
  27              	.macro Getchar buf_addr
  28              		movl $3, %eax		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ read
  29              		movl $0, %ebx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 1: –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤–≤–æ–¥–∞
  30              		movl \buf_addr, %ecx	# –ø–∞—Ä–∞–º–µ—Ç—Ä 2: –∞–¥—Ä–µ—Å –±—É—Ñ–µ—Ä–∞ (–æ–Ω –∂–µ - —Ñ–∞–∫—Ç–∏—á–µ—Å–∫
  31              		     			        # –ø–∞—Ä–∞–º–µ—Ç—Ä –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞)
  32              		movl $1, %edx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 3: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç–æ–≤ –¥–ª—è —á—Ç–µ–Ω–∏—è
  33              		int $0x80		    # –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  34              	.endm
  35              	
  36              	/*
  37              	 * –ú–∞—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –≤—ã–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏ –≤ —Å—Ç–∞–Ω–¥
  38              	 * –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
  39              	 * 	- –°—Ç—Ä–æ–∫–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞.
  40              	 *
  41              	 * –ü—Ä–∏–º–µ—Ç—Ä –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞:
  42              	 *	Puts "–¢–µ–∫—Å—Ç –≤—ã–≤–æ–¥–∏–º–æ–π —Å—Ç—Ä–æ–∫–∏" 
  43              	 *
  44              	 * –†–µ–∑—É–ª—å—Ç–∞—Ç:
  45              	 *	- –≤—ã–≤–æ–¥–∏—Ç –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥ —Å–∏–º–≤–æ–ª—ã –∑–∞–¥–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫
  46              	 *	  –∞ —Ç–∞–∫–∂–µ —Å–∏–º–≤–æ–ª –ø–µ—Ä–µ–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏
  47              	 *	
  48              	 * –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä—ã: %e
  49              	 * –°–º. —Ç–∞–∫–∂–µ 'man puts', 'man 2 write'
  50              	*/
GAS LISTING task4.S 			page 2


  51              	.macro Puts string #–í—ã–≤–æ–¥ —Å—Ç—Ä–æ–∫–∏ –±–µ–∑ –ø–µ—Ä–µ–≤–æ–¥–∞ —Å–∏–º–≤–æ–ª–∞ —Å—Ç—Ä–æ–∫–∏
  52              	.data
  53              	    str\@: 	.ascii "\string"  # —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä–æ–∫–∏ –¥–ª—è
  54              		
  55              	    strlen\@ = 	. - str\@           # –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª–∏–Ω—ã —Å—Ç—Ä–æ–∫–∏
  56              	
  57              	.text
  58              		movl $4, %eax		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ write
  59              		movl $1, %ebx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 1: –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞	
  60              		movl $str\@, %ecx	# –ø–∞—Ä–∞–º–µ—Ç—Ä 2: –∞–¥—Ä–µ—Å –ø–∞–º—è—Ç–∏ —Å –≤—ã–≤–æ–¥–∏–º—ã–º–∏ —Å–∏–º–≤–æ
  61              		movl $strlen\@, %edx 	# –ø–∞—Ä–∞–º–µ—Ç—Ä 3: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç–æ–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞
  62              		int $0x80		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  63              	.endm
  64              				
  65              	.macro Putsn string #–í—ã–≤–æ–¥ —Å—Ç—Ä–æ–∫–∏ —Å –ø–µ—Ä–µ–≤–æ–¥–æ–º —Å–∏–º–≤–æ–ª–∞
  66              	.data
  67              	    str\@: 	.ascii "\string\n"  
  68              	    strlen\@ = 	. - str\@           
  69              	.text
  70              		movl $4, %eax		
  71              		movl $1, %ebx			
  72              		movl $str\@, %ecx	
  73              		movl $strlen\@, %edx 	
  74              		int $0x80		
  75              	.endm
  76              	
  77              	.macro Putn # –í—ã–≤–æ–¥ —á–∏—Å–ª–∞: eax - —Å—É–º–º–∞, ebx - –æ—Å–Ω–æ–≤–∞–Ω–∏–µ
  78              	.bss
  79              		.lcomm buf1\@, 10
  80              	.data
  81              	mins\@: .short -1
  82              	
  83              	.text
  84              	check_minus_p\@:         # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –º–∏–Ω—É—Å
  85              		movl $0, %esi
  86              		cmpw $0, result      # –≤ —Å—É–º–º–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å —á–∏—Å–ª–æ –º–µ–Ω—å—à–µ 0?
  87              		jl place_minus\@     # –î–ê - –Ω–∞ –≤—ã–≤–æ–¥ –º–∏–Ω—É—Å–∞
  88              		jmp place_numbers\@  # –Ω–∞ –ø–µ—Ä–µ–≤–æ–¥ —Å—É–º–º—ã –≤ —Å–∏—Å—Ç–µ–º—É —Å—á–∏—Å–ª–µ–Ω–∏—è ebx
  89              	
  90              	place_minus\@:           # –ï—Å–ª–∏ –º–∏–Ω—É—Å - –≤—ã–≤–µ–¥–µ–º –µ–≥–æ –∏ –≤–æ–∑—å–º–µ–º —á–∏—Å–ª–æ
  91              		movw %bx, %bp        # —É–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å bp –Ω–∞ –±–∞–∑
  92              		Puts "-"             # –≤—ã–≤–æ–¥–∏–º —Å–Ω–∞—á–∞–ª–∞ –∑–Ω–∞–∫ -
  93              		movl $0, %eax        # –ø–æ–º–µ—â–∞–µ–º 0 –ø–æ—Å–ª–µ –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞ Puts
  94              		movw result, %ax     # –ø–æ–º–µ—â–∞–µ–º —Å—É–º–º—É –≤ —Ä–µ–≥–∏—Å—Ç—Ä %eax
  95              		movw %bp, %bx        # –æ–±—Ä–∞—Ç–Ω–æ –ø–æ–º–µ—â–∞–µ–º –æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤ %ebx
  96              		negw %ax	     # –∏–∑–º–µ–Ω—è–µ–º –∑–Ω–∞–∫ –Ω–∞ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–π —É —Å—É–º–º—ã
  97              		jmp place_numbers\@  # –Ω–∞ –ø–µ—Ä–µ–≤–æ–¥ —Å—É–º–º—ã –≤ —Å–∏—Å—Ç–µ–º—É —Å—á–∏—Å–ª–µ–Ω–∏—è ebx
  98              	
  99              	place_numbers\@:         # –î–µ–ª–∏–º
 100              		movl $0, %edx        # –≥–æ—Ç–æ–≤–∏–º –¥–µ–ª–µ–Ω–∏–µ
 101              		idivw %bx            # –¥–µ–ª–∏–º –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ, —á–∞—Å—Ç–Ω–æ–µ —É—Ö–æ–¥–∏—Ç –≤ %edx 
 102              		add $'0', %dl        # —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –Ω–∞ –∫–æ–¥ 0, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–∏–º–≤–
 103              		movb %dl, buf1\@(%esi) # –∑–∞–ø–∏—Å—ã–≤–∞–µ–º —Å–∏–º–≤–æ–ª –≤ –±—É—Ñ–µ—Ä
 104              		inc %esi             # —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –Ω–∞ 1, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ —Å–∏
 105              		cmp $0, %ax          # —á–∞—Å—Ç–Ω–æ–µ = 0?
 106              		je preinverted\@      # –î–ê - –≥–æ—Ç–æ–≤–∏–º—Å—è –∫ —Ä–∞–∑–≤–æ—Ä–æ—Ç—É –±—É—Ñ–µ—Ä–∞ —Å —Å–∏–º–≤–æ
 107              		jmp place_numbers\@  # –ù–ï–¢ - –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –¥–µ–ª–∏—Ç—å
GAS LISTING task4.S 			page 3


 108              	
 109              	preinverted\@:           #–ü–æ–¥–≥–æ—Ç–æ–≤–∏–º—Å—è –∫ —Ä–∞–∑–≤–æ—Ä–æ—Ç—É –±—É—Ñ–µ—Ä–∞ —Å —Ü–∏—Ñ—Ä–∞
 110              		movl %esi, %ecx      # –ø–æ–º–µ—â–∞–µ–º –≤ ecx –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–∏—Ñ—Ä —Å—É–º–º—ã
 111              		dec %ecx             # —É–∫–∞–∑–∞—Ç—å –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∞–¥—Ä–µ—Å –±—É—Ñ–µ—Ä–∞ 
 112              		movl %esi, %eax      # –ø–æ–º–µ—â–∞–µ–º –≤ e–∞x –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤ —Å—É–º–º—ã
 113              		movl $0, %edx
 114              		movl $2, %ebx        # –±—É–¥–µ–º —É–∑–Ω–∞–≤–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞–º –Ω—É–∂–
 115              		idivl %ebx           # –¥–µ–ª–∏–º, —á–∞—Å—Ç–Ω–æ–µ —É—Ö–æ–¥–∏—Ç –≤ %edx 
 116              		movl $0, %esi
 117              		jmp inverted\@        # –ø–µ—Ä–µ—Ö–æ–¥–∏–º –¥–ª—è —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞ –±—É—Ñ–µ—Ä–∞
 118              	
 119              	inverted\@:              # –†–∞–∑–≤–æ—Ä–æ—Ç –±—É—Ñ–µ—Ä–∞
 120              		cmp %eax, %esi       # –≤—Å–µ —Å–∏–º–≤–æ–ª—ã –ø–æ–º–µ–Ω—è–ª–∏ –º–µ—Å—Ç–∞–º–∏? 
 121              		je put_out\@         # –î–ê - –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –≤—ã–≤–æ–¥
 122              		movb buf1\@(%esi), %bl # –ø–æ–º–µ—â–∞–µ–º –∫–æ–¥ —Å–∏–º–≤–æ–ª–∞ –∫ %bl –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é %esi 
 123              		movl %ecx, %edx      # –ø–æ–º–µ—â–∞–µ–º –≤ %edx –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∑–∏—Ü–∏–π –±—É—Ñ–µ—Ä–∞
 124              		sub %esi, %edx       # —É–∑–Ω–∞–µ–º, –Ω–∞ –∫–∞–∫–æ–µ –º–µ—Å—Ç–æ –º–µ–Ω—è—Ç—å
 125              		# –¥–∞–ª–µ–µ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ–º –æ–±–º–µ–Ω —Å–∏–º–≤–æ–ª–æ–≤ –º–µ—Å—Ç–∞–º–∏ 
 126              		movb buf1\@(%edx), %bh
 127              		movb %bl, buf1\@(%edx)
 128              		movb %bh , buf1\@(%esi)
 129              		inc %esi             # —É–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∞–¥—Ä–µ—Å –±—É—Ñ–µ—Ä–∞ –¥–ª—è —Å–ª–
 130              		jmp inverted\@        # –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Ä–∞–∑–≤–æ—Ä–æ—Ç –±—É—Ñ–µ—Ä–∞
 131              	
 132              	put_out\@: #–í—ã–≤–æ–¥
 133              		inc %ecx             # —É–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∞–¥—Ä–µ—Å –±—É—Ñ–µ—Ä–∞ 
 134              		movl $4, %eax        # –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ write
 135              		movl $1, %ebx        # –ø–∞—Ä–∞–º–µ—Ç—Ä 1: –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–
 136              		movl %ecx, %edx      # –ø–∞—Ä–∞–º–µ—Ç—Ä 2: –∞–¥—Ä–µ—Å –ø–∞–º—è—Ç–∏ —Å –≤—ã–≤–æ–¥–∏–º—ã–º–∏ —Å–∏–º–
 137              		movl $buf1\@, %ecx   # –ø–∞—Ä–∞–º–µ—Ç—Ä 3: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç–æ–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞
 138              		int $0x80            # –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
 139              	.endm
 140              	
   8              	
   9              	.bss
  10              	    .lcomm buf, 10 # –±—É—Ñ–µ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤. –†
  11              	    .lcomm c, 1 # –±—É—Ñ–µ—Ä –¥–ª—è —á—Ç–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å–∏–º–≤–æ–ª–∞. –†–∞–∑–º–µ—Ä - 1 
  12              	
  13              	.data # —Å–µ–∫—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
  14              	      #—Å–æ–æ—Ç–≤. –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —è–∑—ã–∫–∞ C –∏ –∫–æ–º–º–µ–Ω—Ç.
  15 0000 0000     	result: .short 0  # –†–µ–∑—É–ª—å—Ç–∞—Ç —Å—É–º–º—ã (—Ä–∞–∑–º–µ—Ä 2 –±–∞–π—Ç–∞)
  16 0002 0A00     	ten:    .word 10  # –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –¥–ª—è –¥–µ–ª–µ–Ω–∏—è –Ω–∞ 10
  17 0004 0200     	two:	.word 2   # –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –¥–ª—è –¥–µ–ª–µ–Ω–∏—è –Ω–∞ 2
  18 0006 0800     	eight:	.word 8	  # –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –¥–ª—è –¥–µ–ª–µ–Ω–∏—è –Ω–∞ 8
  19              	
  20              	.text                # —Å–µ–∫—Ü–∏—è –∫–æ–º–∞–Ω–¥ –ø—Ä–æ—Ü–µ—Å–æ—Ä–∞ 
  21              	    .global _start   # —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ - –≥–ª–æ–±–∞–ª—å–Ω–∞—è –º–µ—Ç–∫–∞
  22              	
  23              	_start:
  24 0000 29F6     	    sub %esi, %esi   # —É–∫–∞–∑–∞—Ç–µ–ª—å –∞–¥—Ä–µ—Å–∞ –±–∞–π—Ç–∞ –≤ –±—É—Ñ–µ—Ä–µ —Å–∏–º–≤–æ–ª–æ–≤ 
  25              	
  26              	kbd_input:
  27              	  
  28              	        Getchar $c      # –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤ –≤–≤–æ–¥–∞ —Å–∏–º–≤–æ–ª–∞ —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–
  28 0002 B8030000 	>  movl $3,%eax
  28      00
  28 0007 BB000000 	>  movl $0,%ebx
GAS LISTING task4.S 			page 4


  28      00
  28 000c B90A0000 	>  movl $c,%ecx
  28      00
  28              	>  
  28 0011 BA010000 	>  movl $1,%edx
  28      00
  28 0016 CD80     	>  int $0x80
  29 0018 83F800   	        cmpl $0, %eax   # –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª - EOF (–≤–≤–µ–¥–µ–Ω–æ 0 —Å–∏–º–≤–æ–ª–æ–≤) ?
  30 001b 0F84BC01 	        je stop         # –î–∞ - –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
  30      0000
  31 0021 803D0A00 	        cmpb $'\n', c   # —ç—Ç–æ —Å–∏–º–≤–æ–ª –ø–µ—Ä–µ–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏ ?
  31      00000A
  32 0028 7437     	        je presum       # –î–ê - –ø—ã—Ç–∞–µ–º—Å—è –ø—Ä–∏–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–∏–º–≤–æ–
  33 002a 803D0A00 	        cmpb $'-', c    # –≤–≤–µ–¥–µ–Ω –∑–Ω–∞–∫ –º–∏–Ω—É—Å?
  33      00002D
  34 0031 7420     	        je write_minus  # –î–ê - –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –∑–∞–ø–∏—Å—å –µ–≥–æ –≤ –±—É—Ñ–µ—Ä
  35 0033 803D0A00 	        cmpb $'9', c    # –∫–æ–¥ –±–æ–ª—å—à–µ –∫–æ–¥–∞ —Å–∏–º–≤–æ–ª–∞ '9' ?
  35      000039
  36 003a 77C6     	        ja kbd_input    # –î–ê - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –µ–≥–æ
  37 003c 803D0A00 	        cmpb $'0', c    # –∫–æ–¥ –º–µ–Ω—å—à–µ –∫–æ–¥–∞ —Å–∏–º–≤–æ–ª–∞ '0' ?
  37      000030
  38 0043 72BD     	        jb kbd_input    # –î–ê - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –µ–≥–æ
  39 0045 A00A0000 	        movb c, %al     # –∫–æ–¥ –∏–∑ —Å –ø–∏—à–µ–º –≤ al
  39      00
  40 004a 88860000 	        movb %al, buf(%esi)  # –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ al (–≤–≤–µ–¥–µ–Ω–Ω—ã–π —Å–∏–
  40      0000
  41              				                 # –∞–¥—Ä–µ—Å—É buf + esi (–±—É—Ñ–µ—Ä –¥–ª—è –≤–≤–æ–¥–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤)
  42 0050 46       	        incl %esi       # —É–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∞–¥—Ä–µ—Å –±—É—Ñ–µ—Ä–∞
  43 0051 EBAF     	        jmp kbd_input   # –Ω–∞ –≤–≤–æ–¥ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–∏–º–≤–æ–ª–∞
  44              			
  45              	write_minus:
  46 0053 A00A0000 	        movb c, %al     # –∫–æ–¥ –∏–∑ —Å –ø–∏—à–µ–º –≤ al
  46      00
  47 0058 88860000 	        movb %al, buf(%esi) # –±–∞–π—Ç–æ–≤–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ, –∏–∑ –±—É—Ñ–µ—Ä–∞ buf + esi 
  47      0000
  48 005e 46       	        incl %esi       # —É–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∞–¥—Ä–µ—Å –±—É—Ñ–µ—Ä–∞ 
  49 005f EBA1     	        jmp kbd_input   # –Ω–∞ –≤–≤–æ–¥ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–∏–º–≤–æ–ª–∞
  50              	
  51              	presum:
  52 0061 BA000000 	        movl $0, %edx   # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–≥–∏—Å—Ç—Ä—ã –¥–ª—è —Å—É–º–º—ã
  52      00
  53 0066 B9000000 	        movl $0, %ecx
  53      00
  54 006b B8000000 	        movl $0, %eax
  54      00
  55 0070 89F7     	        movl %esi, %edi # –≤ –ø—Ä–∏–µ–º–Ω—ã–π —Ä–µ–≥–∏—Å—Ç—Ä edi –∫–æ–ø–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–
  56 0072 4E       	        decl %esi       # —É–∫–∞–∑–∞—Ç—å –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∞–¥—Ä–µ—Å –±—É—Ñ–µ—Ä–∞ 
  57 0073 EB00     	        jmp check_minus # –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–≥–æ —á–∏—Å–ª–∞
  58              	
  59              	check_minus: 
  60 0075 4E       	        decl %esi        # —É–∫–∞–∑–∞—Ç—å –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∞–¥—Ä–µ—Å –±—É—Ñ–µ—Ä–∞
  61 0076 83FE00   	        cmpl $0, %esi    # –∑–Ω–∞—á–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞ –º–µ–Ω—å—à–µ 0?
  62 0079 7C12     	        jl plus          # –î–ê - –Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ ecx = 0
  63 007b 80BE0000 	        cmpb $'-', buf(%esi)  # –≤ –±—É—Ñ–µ—Ä–µ –∑–Ω–∞–∫ –º–∏–Ω—É—Å?
  63      00002D
  64 0082 7402     	        je minus         # –î–ê - –Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ ecx = 1
  65 0084 EB07     	        jmp plus         # —á–∏—Å–ª–æ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ, –Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ ecx
GAS LISTING task4.S 			page 5


  66              	
  67              	minus: 
  68 0086 66B90100 	        movw $1, %cx     # –ø–æ–º–µ—â–∞–µ–º –≤ ecx 1 (–∑–Ω–∞—á–∏—Ç, —á–∏—Å–ª–æ –æ—Ç—Ä–∏—Ü.)
  69 008a 46       	        inc %esi         # —É–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∞–¥—Ä–µ—Å –±—É—Ñ–µ—Ä–∞ 
  70 008b EB07     	        jmp summation    # –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–∏—Å–ª–∞ –∏ —Å—É–º–º–∏—Ä–
  71              	
  72              	plus: 
  73 008d 66B90000 	        movw $0, %cx     # –ø–æ–º–µ—â–∞–µ–º –≤ ecx  (–∑–Ω–∞—á–∏—Ç, —á–∏—Å–ª–æ –ø–æ–ª–æ–∂–∏—Ç.)
  74 0091 46       	        inc %esi         # —É–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∞–¥—Ä–µ—Å –±—É—Ñ–µ—Ä–∞ 
  75 0092 EB00     	        jmp summation    # –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–∏—Å–ª–∞ –∏ —Å—É–º–º–∏—Ä–
  76              	
  77              	summation: 
  78 0094 83FEFF   	        cmp $-1, %esi    # –≤ esi -1?
  79 0097 7454     	        je output        # —Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –≤—ã–≤–æ–¥
  80 0099 66BB3000 	        movw $'0', %bx   # –≤ ebx –∑–∞–Ω–æ—Å–∏–º –∫–æ–¥ 0
  81 009d 8A860000 	        movb buf(%esi), %al # –±–∞–π—Ç–æ–≤–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ, –∏–∑ –±—É—Ñ–µ—Ä–∞ buf + esi 
  81      0000
  82 00a3 C6860000 	        movb $0, buf(%esi)  # –≤ –±—É—Ñ–µ—Ä –ø–æ–º–µ—â–∞–µ–º 0
  82      000000
  83 00aa 6629D8   	        sub %bx, %ax     # –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞–µ–º –∫–æ–¥ —Å–∏–º–≤–æ–ª–∞ —Ü–∏—Ñ—Ä—ã –≤ —Å–∞–
  84 00ad 4E       	        dec %esi         # —É–∫–∞–∑–∞—Ç—å –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∞–¥—Ä–µ—Å –±—É—Ñ–µ—Ä–∞ 
  85 00ae 6683F901 		cmp $1, %cx      # –≤ ecx 1? (–±—ã–ª–æ –≤–≤–µ–¥–µ–Ω–æ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ?)
  86 00b2 7406     	        je razn          # –î–ê - –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≤—ã—á–∏—Ç–∞–Ω–∏–µ
  87 00b4 6683F900 	        cmp $0, %cx      # –≤ ecx 0? (–±—ã–ª–æ –≤–≤–µ–¥–µ–Ω–æ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ
  88 00b8 741A     	        je summ          # –î–ê - –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–æ–∂–µ–Ω–∏–µ
  89              	
  90              	razn:
  91 00ba 668B1D00 	        movw result, %bx # –∫–æ–ø–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç(—Å—É–º–º—É) –≤ ebx
  91      000000
  92 00c1 6629C3   	        sub %ax, %bx     # –ø—Ä–æ–±—É–µ–º –≤—ã—á–µ—Å—Ç—å
  93 00c4 0F80FB00 	        jo error         # –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–æ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ, —Ç–æ –ø–µ—Ä–µ—Ö–æ–
  93      0000
  94 00ca 66891D00 	        movw %bx, result # –ø–æ–ª—É—á–∏–≤—à—É—é—Å—è —Å—É–º–º—É –ø–µ—Ä–µ–Ω–æ—Å–∏–º –æ–±—Ä–∞—Ç–Ω–æ –≤
  94      000000
  95 00d1 4E       	        dec %esi         # —É–∫–∞–∑–∞—Ç—å –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∞–¥—Ä–µ—Å –±—É—Ñ–µ—Ä–∞ 
  96 00d2 EB19     	        jmp output       # –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≤—ã–≤–æ–¥ —Å—É–º–º—ã
  97              	
  98              	summ: 
  99 00d4 668B1D00 	        movw result, %bx # –∫–æ–ø–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç(—Å—É–º–º—É) –≤ ebx
  99      000000
 100 00db 6601C3   	        add %ax, %bx     # –ø—Ä–æ–±—É–µ–º —Å–ª–æ–∂–∏—Ç—å
 101 00de 0F80E100 	        jo error         # –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–æ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ, —Ç–æ –ø–µ—Ä–µ—Ö–æ–
 101      0000
 102 00e4 66891D00 	        movw %bx, result # –ø–æ–ª—É—á–∏–≤—à—É—é—Å—è —Å—É–º–º—É –ø–µ—Ä–µ–Ω–æ—Å–∏–º –æ–±—Ä–∞—Ç–Ω–æ –≤
 102      000000
 103 00eb EB00     	        jmp output       # –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≤—ã–≤–æ–¥ —Å—É–º–º—ã
 104              	
 105              	output: 
 106 00ed 66A10000 		mov result, %ax      # –ø–æ–º–µ—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç(—Å—É–º–º—É) –≤ eax
 106      0000
 107 00f3 BB0A0000 		mov $10, %ebx        # –ø–æ–º–µ—â–∞–µ–º 10 –≤ ebx 
 107      00
 108              		Putn                 # –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å—É–º–º—ã –ø–æ –æ—Å–Ω–æ–≤–∞–Ω–∏—é
 108              	> .bss 
 108              	>  .lcomm buf11,10
 108              	> .data 
 108 0008 FFFF     	> mins1:.short -1
GAS LISTING task4.S 			page 6


 108              	>  
 108              	> .text 
 108              	> check_minus_p1:
 108 00f8 BE000000 	>  movl $0,%esi
 108      00
 108 00fd 66833D00 	>  cmpw $0,result
 108      00000000 
 108 0105 7C02     	>  jl place_minus1
 108 0107 EB2C     	>  jmp place_numbers1
 108              	>  
 108              	> place_minus1:
 108 0109 6689DD   	>  movw %bx,%bp
 108              	>  Puts "-"
 108              	>> .data 
 108 000a 2D       	>>  str2:.ascii "-"
 108              	>>  
 108              	>>  strlen2 =. - str2
 108              	>>  
 108              	>> .text 
 108 010c B8040000 	>>  movl $4,%eax
 108      00
 108 0111 BB010000 	>>  movl $1,%ebx
 108      00
 108 0116 B90A0000 	>>  movl $str2,%ecx
 108      00
 108 011b BA010000 	>>  movl $strlen2,%edx
 108      00
 108 0120 CD80     	>>  int $0x80
 108 0122 B8000000 	>  movl $0,%eax
 108      00
 108 0127 66A10000 	>  movw result,%ax
 108      0000
 108 012d 6689EB   	>  movw %bp,%bx
 108 0130 66F7D8   	>  negw %ax
 108 0133 EB00     	>  jmp place_numbers1
 108              	>  
 108              	> place_numbers1:
 108 0135 BA000000 	>  movl $0,%edx
 108      00
 108 013a 66F7FB   	>  idivw %bx
 108 013d 80C230   	>  add $48,%dl
 108 0140 88961000 	>  movb %dl,buf11(%esi)
 108      0000
 108 0146 46       	>  inc %esi
 108 0147 6683F800 	>  cmp $0,%ax
 108 014b 7402     	>  je preinverted1
 108 014d EBE6     	>  jmp place_numbers1
 108              	>  
 108              	> preinverted1:
 108 014f 89F1     	>  movl %esi,%ecx
 108 0151 49       	>  dec %ecx
 108 0152 89F0     	>  movl %esi,%eax
 108 0154 BA000000 	>  movl $0,%edx
 108      00
 108 0159 BB020000 	>  movl $2,%ebx
 108      00
 108 015e F7FB     	>  idivl %ebx
GAS LISTING task4.S 			page 7


 108 0160 BE000000 	>  movl $0,%esi
 108      00
 108 0165 EB00     	>  jmp inverted1
 108              	>  
 108              	> inverted1:
 108 0167 39C6     	>  cmp %eax,%esi
 108 0169 741F     	>  je put_out1
 108 016b 8A9E1000 	>  movb buf11(%esi),%bl
 108      0000
 108 0171 89CA     	>  movl %ecx,%edx
 108 0173 29F2     	>  sub %esi,%edx
 108              	>  
 108 0175 8ABA1000 	>  movb buf11(%edx),%bh
 108      0000
 108 017b 889A1000 	>  movb %bl,buf11(%edx)
 108      0000
 108 0181 88BE1000 	>  movb %bh,buf11(%esi)
 108      0000
 108 0187 46       	>  inc %esi
 108 0188 EBDD     	>  jmp inverted1
 108              	>  
 108              	> put_out1:
 108 018a 41       	>  inc %ecx
 108 018b B8040000 	>  movl $4,%eax
 108      00
 108 0190 BB010000 	>  movl $1,%ebx
 108      00
 108 0195 89CA     	>  movl %ecx,%edx
 108 0197 B9100000 	>  movl $buf11,%ecx
 108      00
 108 019c CD80     	>  int $0x80
 109              		Puts " "             # –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤ –≤—ã–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏ –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π 
 109              	> .data 
 109 000b 20       	>  str3:.ascii " "
 109              	>  
 109              	>  strlen3 =. - str3
 109              	>  
 109              	> .text 
 109 019e B8040000 	>  movl $4,%eax
 109      00
 109 01a3 BB010000 	>  movl $1,%ebx
 109      00
 109 01a8 B90B0000 	>  movl $str3,%ecx
 109      00
 109 01ad BA010000 	>  movl $strlen3,%edx
 109      00
 109 01b2 CD80     	>  int $0x80
 110 01b4 BE000000 		movl $0, %esi        # –æ—á–∏—â–∞–µ–º —Ä–µ–≥–∏—Å—Ç—Ä
 110      00
 111 01b9 C6860000 		movb $0, buf(%esi)   # –æ—á–∏—â–∞–µ–º –±—É—Ñ–µ—Ä
 111      000000
 112 01c0 E93DFEFF 		jmp kbd_input        # –Ω–∞ –≤–≤–æ–¥ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–∏–º–≤–æ–ª–∞
 112      FF
 113              	
 114              	error:
 115              		Puts "–°—É–º–º–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞. –ö–æ–Ω–µ—Ü –ø—Ä–æ–≥—Ä–∞–º–º—ã" # —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø
 115              	> .data 
GAS LISTING task4.S 			page 8


 115 000c D0A1D183 	>  str4:.ascii "–°—É–º–º–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞. –ö–æ–Ω–µ—Ü –ø—Ä–æ–≥—Ä–∞–º–º—ã"
 115      D0BCD0BC 
 115      D0B020D0 
 115      BFD0B5D1 
 115      80D0B5D0 
 115              	>  
 115              	>  strlen4 =. - str4
 115              	>  
 115              	> .text 
 115 01c5 B8040000 	>  movl $4,%eax
 115      00
 115 01ca BB010000 	>  movl $1,%ebx
 115      00
 115 01cf B90C0000 	>  movl $str4,%ecx
 115      00
 115 01d4 BA400000 	>  movl $strlen4,%edx
 115      00
 115 01d9 CD80     	>  int $0x80
 116 01db EB00     		jmp stop                                  # –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
 117              	 
 118              	 
 119              	stop:
 120              	    Exit $0
 120 01dd B8010000 	>  movl $1,%eax
 120      00
 120 01e2 BB000000 	>  movl $0,%ebx
 120      00
 120 01e7 CD80     	>  int $0x80
 121              	
 122              	.end
GAS LISTING task4.S 			page 9


DEFINED SYMBOLS
             task4.S:10     .bss:0000000000000000 buf
             task4.S:10     .bss:000000000000000a c
             task4.S:15     .data:0000000000000000 result
             task4.S:16     .data:0000000000000002 ten
             task4.S:17     .data:0000000000000004 two
             task4.S:18     .data:0000000000000006 eight
             task4.S:23     .text:0000000000000000 _start
             task4.S:26     .text:0000000000000002 kbd_input
             task4.S:119    .text:00000000000001dd stop
             task4.S:51     .text:0000000000000061 presum
             task4.S:45     .text:0000000000000053 write_minus
             task4.S:59     .text:0000000000000075 check_minus
             task4.S:72     .text:000000000000008d plus
             task4.S:67     .text:0000000000000086 minus
             task4.S:77     .text:0000000000000094 summation
             task4.S:105    .text:00000000000000ed output
             task4.S:90     .text:00000000000000ba razn
             task4.S:98     .text:00000000000000d4 summ
             task4.S:114    .text:00000000000001c5 error
             task4.S:108    .bss:0000000000000010 buf11
             task4.S:108    .data:0000000000000008 mins1
             task4.S:108    .text:00000000000000f8 check_minus_p1
             task4.S:108    .text:0000000000000109 place_minus1
             task4.S:108    .text:0000000000000135 place_numbers1
             task4.S:108    .data:000000000000000a str2
             task4.S:108    *ABS*:0000000000000001 strlen2
             task4.S:108    .text:000000000000014f preinverted1
             task4.S:108    .text:0000000000000167 inverted1
             task4.S:108    .text:000000000000018a put_out1
             task4.S:109    .data:000000000000000b str3
             task4.S:109    *ABS*:0000000000000001 strlen3
             task4.S:115    .data:000000000000000c str4
             task4.S:115    *ABS*:0000000000000040 strlen4

NO UNDEFINED SYMBOLS
